<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Liturgia</title>
        <link href='https://fonts.googleapis.com/css?family=Crimson+Text:400,700,700italic,400italic' rel='stylesheet' type='text/css'>
        <script type="text/javascript" src="https://bbloomf.github.io/jgabc/exsurge.min.js"></script>
        <script>
            function getNothing() {
                return document.createElement("div");
            }
            class AntiphonaleRomanum {
                static getPrayersBeforeLittleOffice() {
                    const element = document.createElement("p");
                    element.innerText = "Ave Maria";
                    return element;
                }
                static getDeusInAdjutoriumTonusFestivus(isASeptuagesimaUsqueAdPascha) {
                    const element = document.createElement("p");
                    element.innerText = "Deus in adjutorium (Tonus festivus). " + (isASeptuagesimaUsqueAdPascha ? "Laus tibi..." : "Gloria Patri...");
                    return element;
                }
                static getDeusInAdjutoriumTonusFerialis(isASeptuagesimaUsqueAdPascha) {
                    const element = document.createElement("p");
                    element.innerText = "Deus in adjutorium (Tonus ferialis). " + (isASeptuagesimaUsqueAdPascha ? "Laus tibi..." : "Gloria Patri...");
                    return element;
                }
            }
            class DeaconOrHigher {
                getSalutation() {
                    const element = document.createElement("p");
                    element.innerText = "Dominus vobiscum...";
                    return element;
                }
            }
            class LessThanDeacon {
                getSalutation() {
                    const element = document.createElement("p");
                    element.innerText = "Domine exaudi...";
                    return element;
                }
            }
            class Rubrics {

            }
            class DivinoAfflatu extends Rubrics {
                constructor(isASeptuagesimaUsqueAdPascha, isSundayOrFeast) {
                    super();
                    this.isASeptuagesimaUsqueAdPascha = isASeptuagesimaUsqueAdPascha;
                    this.isSundayOrFeast = isSundayOrFeast;
                }
                getPrayersBeforeLittleOffice(isSundayOrFeast) {
                    return AntiphonaleRomanum.getPrayersBeforeLittleOffice();
                }
                getMajorHoursDeusInAdjutorium() {
                    if (this.isSundayOrFeast) {
                        return AntiphonaleRomanum.getDeusInAdjutoriumTonusFestivus(this.isASeptuagesimaUsqueAdPascha);
                    } else {
                        return AntiphonaleRomanum.getDeusInAdjutoriumTonusFerialis(this.isASeptuagesimaUsqueAdPascha);
                    }
                }
                getMinorHoursDeusInAdjutorium() {
                    return AntiphonaleRomanum.getDeusInAdjutoriumTonusFerialis(this.isASeptuagesimaUsqueAdPascha);
                }
            }
            class CumNostra extends DivinoAfflatu {
                constructor(isASeptuagesimaUsqueAdPascha, isSundayOrFeast) {
                    super(isASeptuagesimaUsqueAdPascha, isSundayOrFeast);
                }
                getPrayersBeforeLittleOffice() {
                    return getNothing();
                }
            }
            class RubricarumInstructum extends CumNostra {
                constructor(isASeptuagesimaUsqueAdPascha, isSundayOrFeast) {
                    super(isASeptuagesimaUsqueAdPascha, isSundayOrFeast);
                }
                getMajorHoursDeusInAdjutorium() {
                    return AntiphonaleRomanum.getDeusInAdjutoriumTonusFestivus(this.isASeptuagesimaUsqueAdPascha);
                }
                getMinorHoursDeusInAdjutorium() {
                    return AntiphonaleRomanum.getDeusInAdjutoriumTonusFerialis(this.isASeptuagesimaUsqueAdPascha);
                }
            }
            class Hour {
                constructor(rubrics) {
                    this.rubrics = rubrics;
                }
                getHour() {
                    const element = document.createElement("div");
                    element.appendChild(this.getIntro());
                    //element.appendChild(this.getBody());
                    //element.appendChild(this.getConclusion());
                    return element;
                }
            }
            class Vespers extends Hour {
                constructor(rubrics) {
                    super(rubrics);
                }
                getIntro() {
                    const element = document.createElement("div");
                    element.appendChild(this.rubrics.getPrayersBeforeLittleOffice());
                    element.appendChild(this.rubrics.getMajorHoursDeusInAdjutorium());
                    return element;
                }
            }
            class VespersPerAnnum extends Vespers {
                constructor(rubrics) {
                    super(rubrics);
                }
            }
            class VespersInAdventu extends VespersPerAnnum {
                constructor(rubrics) {
                    super(rubrics)
                }
            }
            class VespersPostNativitatem extends VespersPerAnnum {
                constructor(rubrics) {
                    super(rubrics);
                }
            }
            class Gathering {
                constructor(rubrics) {
                    this.rubrics = rubrics;
                }
                getElement() {
                    const element = document.createElement("div");
                    const title = document.createElement("h1");
                    title.innerText = "Liturgia";
                    element.appendChild(title);
                    element.appendChild(new VespersPerAnnum(this.rubrics).getHour());
                    return element;
                }
            }
        </script>
    </head>

    <body>

    </body>
    <script>
        //const person = new LessThanDeacon();
        //const rubrics = new RubricarumInstructum(false, false);
        //document.body.appendChild(new Gathering(rubrics).getElement());

        var theDiv = document.createElement("div");
        document.body.appendChild(theDiv);
        chant(theDiv, "(c4) CHris(ffg)tus(f.) *(,) fac(fg)tus(f) est(f') pro(f) no(ghF'ED.g_e/fg)bis(f.) (;) o(f)bé(hf/gh!jj/kjk)di(jij)ens(h_g) (,) us(h!jjh)que(f.) ad(ixfiH'Gh) mor(fgf___)tem,(f.) (:) mor(ixf!hhi)tem(g) au(ixgjj//)tem(j.h!iw!jvIG'hw!ivHG) cru(fv.ff)cis.(f_c) (,) (fg!hvGF.e!g'h//fhg/hggf.) V/.(z0::c3)  Prop(d)ter(d) quod(d) et(fe~) De(eh)us(h.) (,) e(h)xal(h)tá(h)vit(h) il(h)lum,(ihhe.//hih___/ihhe.) (,) (hi!kv//lvKI'jvHF.) (,) (h_g/ijh'___ jvIH'jvIH'//hvGF.) (:) et(f) de(f!h'i)dit(i) il(i)li(ih/jki/hhf.) (,) no(hf/hhh)men,(h.f!gwh!iv.hi/jhh/iih.) (;) quod(d) est(d) su(d)per(d) o(dfE'D)mne(ef) *() no(fhG'Fhhh)men.(hhf.) (,) (gxg_fgvED.fgED.fehv.hhhff//dfe/feed.) (::)");

        var theDiv2 = document.createElement("div");
        document.body.appendChild(theDiv2);
        chant(theDiv2, "(c4) CHris(ffg)tus(f.)");

        function chant(chantContainer, gabc) {
            var ctxt = new exsurge.ChantContext();
            /*ctxt.lyricTextFont = "'Crimson Text', serif";
            ctxt.lyricTextSize *= 1.2;
            ctxt.dropCapTextFont = ctxt.lyricTextFont;
            ctxt.annotationTextFont = ctxt.lyricTextFont;*/
            var score;

            var updateChant = function() {
                if (score) {
                    exsurge.Gabc.updateMappingsFromSource(ctxt, score.mappings, gabc);
                    score.updateNotations(ctxt);
                } else {
                    mappings = exsurge.Gabc.createMappingsFromSource(ctxt, gabc);
                    score = new exsurge.ChantScore(ctxt, mappings, true);
                    score.annotation = new exsurge.Annotation(ctxt, "%V%");
                }
                layoutChant();
            }
            var layoutChant = function() {
                // perform layout on the chant
                score.performLayoutAsync(ctxt, function() {
                    score.layoutChantLines(ctxt, chantContainer.clientWidth, function() {
                        // render the score to svg code
                        chantContainer.innerHTML = score.createSvg(ctxt);
                    });
                });
            }

            updateChant();

            window.addEventListener("resize", layoutChant);
        }
    </script>
</html>