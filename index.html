<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <style>
            @font-face {
                font-family: 'Versiculum';
                font-style: normal;
                font-weight: normal;
                src: url(data:application/font-woff;charset=utf-8;base64,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) format('woff');
            }
            .versiculum {
                font-family: 'Versiculum';
                font-variant: normal;
                font-size: 130%;
                color: #d00!important;
            }
            body {
                max-width: 800px;
                margin-left: auto;
                margin-right: auto;
            }
        </style>
        <title>Liturgia</title>
        <link href='https://fonts.googleapis.com/css?family=Crimson+Text:400,700,700italic,400italic' rel='stylesheet' type='text/css'>
        <script type="text/javascript" src="https://bbloomf.github.io/jgabc/exsurge.min.js"></script>
        <script>
            function setCookie(cname, cvalue, exdays) {
                var str = cname + "=" + cvalue;
                if (exdays) {
                    var d = new Date();
                    d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
                    var expires = "expires=" + d.toUTCString();
                    str += ";" + expires;
                }
                str += ";path=/";
                document.cookie = str;
            }

            function getCookie(cname) {
                var name = cname + "=";
                var ca = document.cookie.split(';');
                for(var i = 0; i < ca.length; i++) {
                    var c = ca[i];
                    while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                    }
                    if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                    }
                }
                return "";
            }
        </script>
        <script>
            function chant(chantContainer, annotation, gabc) {
                const ctxt = new exsurge.ChantContext();


                ctxt.specialCharProperties['font-family'] = "'Versiculum'";
                ctxt.specialCharProperties['font-variant'] = 'normal';
                ctxt.specialCharProperties['font-size'] = (1.2 * ctxt.lyricTextSize) + 'px';
                ctxt.specialCharProperties['font-weight'] = '400';
                ctxt.specialCharText = function(char) { return char.toLowerCase(); };
                ctxt.setRubricColor('#d00');

                /*ctxt.lyricTextFont = "'Crimson Text', serif";
                ctxt.lyricTextSize *= 1.2;
                ctxt.dropCapTextFont = ctxt.lyricTextFont;
                ctxt.annotationTextFont = ctxt.lyricTextFont;*/

                const mappings = exsurge.Gabc.createMappingsFromSource(ctxt, gabc);
                const score = new exsurge.ChantScore(ctxt, mappings, true);
                if (annotation != null) score.annotation = new exsurge.Annotation(ctxt, annotation);
                
                const layoutChant = () => {
                    score.performLayoutAsync(ctxt, () => {
                        score.layoutChantLines(ctxt, chantContainer.clientWidth, () => {
                            chantContainer.innerHTML = score.createSvg(ctxt);
                        });
                    });
                }

                layoutChant();
                window.addEventListener("resize", layoutChant);
            }
        </script>
        <script>
            function getNothing() {
                return document.createElement("div");
            }
            class AntiphonaleRomanum {
                static getOratioPostDivinumOfficium() {
                    const element = document.createElement("div");
                    element.innerHTML = "<p>Sacrosánctæ et indivíduæ Trinitáti, crucifíxi Dómini nostri Jesu Christi humanitáti, beatíssimæ et gloriosíssimæ sempérque Vírginis Maríæ fecúndæ integritáti, et ómnium Sanctórum universitáti sit sempitérna laus, honor, virtus et glória ab omni creatúra, nobísque remíssio ómnium peccatórum, per infiníta sǽcula sæculórum.</p>"
                        + "<p><span class='versiculum'>r</span> Amen.</p>"
                        + "<p>V. Beáta víscera Maríæ Vírginis, quæ portavérunt ætérni Pátris Fílium.</p>"
                        + "<p>R. Et beáta úbera, quæ lactavérunt Christum Dóminum.</p>";
                    return element;
                }
                static getAveMaria() {
                    const element = document.createElement("p");
                    element.innerText = "Ave María, grátia plena; Dóminus tecum: benedícta tu in muliéribus, et benedíctus fructus ventris tui Jesus. Sancta María, Mater Dei, ora pro nobis peccatóribus, nunc et in hora mortis nostræ. Amen.";
                    return element;
                }
                static getDeusInAdjutoriumTonusFestivus(isASeptuagesimaUsqueAdPascha) {
                    const element = document.createElement("p");
                    element.innerText = "c3f(De)(us) (<b>in</b>) (adjutorium (Tonus festivus). " + (isASeptuagesimaUsqueAdPascha ? "Laus tibi..." : "Gloria Patri...");
                    return element;
                }
                static getDeusInAdjutoriumTonusFerialis(isASeptuagesimaUsqueAdPascha) {
                    const element = document.createElement("p");
                    chant(element, "\Vbar", "(c3)De(h)us(h'_,) ad(h)ju(h)tó(i)ri(h)um(h) me(h)um(h'_) in(h)tén(g)de.(h.:) \Rbar")
                    return element;
                }
            }
            class DeaconOrHigher {
                getSalutation() {
                    const element = document.createElement("p");
                    element.innerText = "Dominus vobiscum...";
                    return element;
                }
            }
            class LessThanDeacon {
                getSalutation() {
                    const element = document.createElement("p");
                    element.innerText = "Domine exaudi...";
                    return element;
                }
            }
            class Rubrics {

            }
            class DivinoAfflatu extends Rubrics {
                constructor(isASeptuagesimaUsqueAdPascha, isSundayOrFeast) {
                    super();
                    this.isASeptuagesimaUsqueAdPascha = isASeptuagesimaUsqueAdPascha;
                    this.isSundayOrFeast = isSundayOrFeast;
                }
                getPrayersBeforeLittleOffice(isSundayOrFeast) {
                    return AntiphonaleRomanum.getAveMaria();
                }
                getMajorHoursDeusInAdjutorium() {
                    if (this.isSundayOrFeast) {
                        return AntiphonaleRomanum.getDeusInAdjutoriumTonusFestivus(this.isASeptuagesimaUsqueAdPascha);
                    } else {
                        return AntiphonaleRomanum.getDeusInAdjutoriumTonusFerialis(this.isASeptuagesimaUsqueAdPascha);
                    }
                }
                getMinorHoursDeusInAdjutorium() {
                    return AntiphonaleRomanum.getDeusInAdjutoriumTonusFerialis(this.isASeptuagesimaUsqueAdPascha);
                }
            }
            class CumNostra extends DivinoAfflatu {
                constructor(isASeptuagesimaUsqueAdPascha, isSundayOrFeast) {
                    super(isASeptuagesimaUsqueAdPascha, isSundayOrFeast);
                }
                getPrayersBeforeLittleOffice() {
                    return getNothing();
                }
            }
            class RubricarumInstructum extends CumNostra {
                constructor(isASeptuagesimaUsqueAdPascha, isSundayOrFeast) {
                    super(isASeptuagesimaUsqueAdPascha, isSundayOrFeast);
                }
            }
            class Hour {
                constructor(rubrics) {
                    this.rubrics = rubrics;
                }
                getHour() {
                    const element = document.createElement("div");
                    element.appendChild(this.getIntro());
                    //element.appendChild(this.getBody());
                    //element.appendChild(this.getConclusion());
                    return element;
                }
            }
            class Vespers extends Hour {
                constructor(rubrics) {
                    super(rubrics);
                }
                getIntro() {
                    const element = document.createElement("div");
                    element.appendChild(this.rubrics.getPrayersBeforeLittleOffice());
                    element.appendChild(this.rubrics.getMajorHoursDeusInAdjutorium());
                    return element;
                }
            }
            class VespersPerAnnum extends Vespers {
                constructor(rubrics) {
                    super(rubrics);
                }
            }
            class VespersInAdventu extends VespersPerAnnum {
                constructor(rubrics) {
                    super(rubrics)
                }
            }
            class VespersPostNativitatem extends VespersPerAnnum {
                constructor(rubrics) {
                    super(rubrics);
                }
            }
            class Gathering {
                constructor(rubrics) {
                    this.rubrics = rubrics;
                }
                getElement() {
                    const element = document.createElement("div");
                    element.appendChild(new VespersPerAnnum(this.rubrics).getHour());
                    element.appendChild(AntiphonaleRomanum.getOratioPostDivinumOfficium());
                    return element;
                }
            }
        </script>
    </head>
    <body>
        <h1>Options</h1>
            <p>Rubrics</p>
            <input id="divinoAfflatuRadioButtton" class="options" type="radio" name="rubrics" value="DivinoAfflatu">
            <label for="DivinoAfflatu">Divino Afflatu (Pius X)</label><br>
            <input id="cumNostraRadioButtton" class="options" type="radio" name="rubrics" value="CumNostra">
            <label for="CumNostra">Cum Nostra (Pius XII)</label><br>
            <input id="rubricarumInstructumRadioButtton" class="options" type="radio" name="rubrics" value="RubricarumInstructum">
            <label for="RubricarumInstructum">Rubricarum Instructum (John XXIII)</label><br>
        <div id="liturgy"></div>
    </body>
    <script>
        (() => {
            const controlsToSettings = () => {
                const settings = {
                    rubrics:
                        document.getElementById("divinoAfflatuRadioButtton").checked ? "divinoAfflatu" :
                        document.getElementById("cumNostraRadioButtton").checked ? "cumNostra" :
                        document.getElementById("rubricarumInstructumRadioButtton").checked ? "rubricarumInstructum" :
                        null
                };
                return settings;
            }

            const settingsToControls = settings => {
                switch (settings.rubrics) {
                    case "divinoAfflatu":
                        document.getElementById("divinoAfflatuRadioButtton").checked = true;
                        break;
                    case "cumNostra":
                        document.getElementById("cumNostraRadioButtton").checked = true;
                        break;
                    case "rubricarumInstructum":
                        document.getElementById("rubricarumInstructumRadioButtton").checked = true;
                        break;
                }
            }

            const gatheringFromSettings = settings => {
                var rubrics;
                switch (settings.rubrics) {
                    case "divinoAfflatu":
                        rubrics = new DivinoAfflatu(false, false);
                        break;
                    case "cumNostra":
                        rubrics = new CumNostra(false, false);
                        break;
                    case "rubricarumInstructum":
                        rubrics = new RubricarumInstructum(false, false);
                        break;
                }

                return new Gathering(rubrics);
            }

            const setDocument = settings => {
                liturgy.innerText = null;
                liturgy.appendChild(gatheringFromSettings(settings).getElement());
            }

            window.addEventListener("load", () => {
                const settingsJson = getCookie("settings");
                
                const settings = settingsJson ?
                    JSON.parse(settingsJson) :
                    { rubrics: "divinoAfflatu" };

                settingsToControls(settings);
                setDocument(settings);
                
                for (optionElement of document.getElementsByClassName("options")) {
                    addEventListener("click", () => {
                        const settings = controlsToSettings();
                        const liturgy = document.getElementById("liturgy");
                        setCookie("settings", JSON.stringify(settings));
                        setDocument(settings);
                    });
                }
            });
        })();
    </script>
</html>